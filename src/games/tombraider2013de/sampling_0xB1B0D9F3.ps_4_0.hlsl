// ---- Created with 3Dmigoto v1.4.1 on Mon Jan 20 14:03:32 2025

cbuffer cb6 : register(b6) {
  int4 g_i2InputSize : packoffset(c0);
  int4 g_i2OutputSize : packoffset(c1);
  float4 DepthToW : packoffset(c2);
  float4 g_vCoCParams : packoffset(c3);
}

SamplerState samplerInputTexture0L_s : register(s1);
Texture2D<float4> mapInputTexture0L : register(t0);
Texture2D<float4> mapInputTexture1P : register(t1);

// 3Dmigoto declarations
#define cmp -

void main(
    float4 v0: SV_POSITION0,
    float4 v1: COLOR0,
    float2 v2: TEXCOORD0,
    out float4 o0: SV_TARGET0) {
  const float4 icb[] = { { 0.710491, 0.703707, 0, 0 },
                         { -0.928918, -0.370287, 0, 0 },
                         { 0.731964, 0.681344, 0, 0 },
                         { 0.427097, -0.904206, 0, 0 },
                         { 0.429236, 0.903192, 0, 0 },
                         { -0.999968, 0.008006, 0, 0 },
                         { -0.889812, 0.456327, 0, 0 },
                         { 0.659050, -0.752100, 0, 0 },
                         { 0.996894, 0.078758, 0, 0 },
                         { 0.975363, -0.220606, 0, 0 },
                         { 0.757239, -0.653138, 0, 0 },
                         { 0.379926, -0.925017, 0, 0 },
                         { -0.957232, -0.289322, 0, 0 },
                         { 0.885485, -0.464668, 0, 0 },
                         { -0.726943, 0.686698, 0, 0 },
                         { -0.920621, 0.390457, 0, 0 },
                         { 0.732435, 0.680837, 0, 0 },
                         { 0.210283, 0.977641, 0, 0 },
                         { -0.198257, 0.980150, 0, 0 },
                         { -0.373270, -0.927723, 0, 0 },
                         { 0.999482, 0.032171, 0, 0 },
                         { -0.402570, 0.915389, 0, 0 },
                         { 0.997633, -0.068771, 0, 0 },
                         { 0.995860, 0.090900, 0, 0 },
                         { -0.780747, 0.624847, 0, 0 },
                         { 0.184445, -0.982843, 0, 0 },
                         { -0.310787, 0.950480, 0, 0 },
                         { -0.032740, -0.999464, 0, 0 },
                         { 0.086333, 0.996266, 0, 0 },
                         { -0.616147, -0.787631, 0, 0 },
                         { -0.128982, 0.991647, 0, 0 },
                         { 0.999362, 0.035710, 0, 0 },
                         { 0.710624, 0.703572, 0, 0 },
                         { -0.545880, 0.837863, 0, 0 },
                         { 0.839608, -0.543193, 0, 0 },
                         { -0.902993, 0.429656, 0, 0 },
                         { 0.532803, -0.846239, 0, 0 },
                         { -0.650858, -0.759200, 0, 0 },
                         { -0.325481, -0.945549, 0, 0 },
                         { -0.637485, -0.770463, 0, 0 },
                         { -0.995287, -0.096968, 0, 0 },
                         { -0.806658, -0.591018, 0, 0 },
                         { -0.944383, 0.328847, 0, 0 },
                         { 0.976587, 0.215121, 0, 0 },
                         { 0.379852, 0.925047, 0, 0 },
                         { 0.884347, -0.466830, 0, 0 },
                         { 0.529144, -0.848532, 0, 0 },
                         { 0.855252, -0.518213, 0, 0 },
                         { 0.888648, 0.458590, 0, 0 },
                         { 0.580155, 0.814506, 0, 0 },
                         { 0.239223, 0.970965, 0, 0 },
                         { -0.983282, -0.182090, 0, 0 },
                         { -0.203888, -0.978994, 0, 0 },
                         { -0.844198, 0.536031, 0, 0 },
                         { 0.929263, 0.369418, 0, 0 },
                         { 0.358143, -0.933667, 0, 0 },
                         { -0.901253, -0.433292, 0, 0 },
                         { 0.790867, 0.611988, 0, 0 },
                         { -0.898445, 0.439085, 0, 0 },
                         { -0.808525, 0.588461, 0, 0 },
                         { 0.318387, 0.947961, 0, 0 },
                         { -0.426950, -0.904275, 0, 0 },
                         { -0.692393, -0.721520, 0, 0 },
                         { -0.676265, 0.736659, 0, 0 },
                         { -0.344567, -0.938762, 0, 0 },
                         { 0.733433, -0.679762, 0, 0 },
                         { -0.380832, -0.924644, 0, 0 },
                         { 0.280121, 0.959965, 0, 0 },
                         { 0.995865, 0.090849, 0, 0 },
                         { 0.951468, -0.307748, 0, 0 },
                         { -0.820930, -0.571029, 0, 0 },
                         { -0.993602, 0.112937, 0, 0 },
                         { -0.992850, -0.119370, 0, 0 },
                         { -0.628784, -0.777580, 0, 0 },
                         { 0.461471, 0.887156, 0, 0 },
                         { -0.825254, 0.564761, 0, 0 },
                         { 0.681203, -0.732095, 0, 0 },
                         { 0.959481, -0.281772, 0, 0 },
                         { 0.462366, -0.886689, 0, 0 },
                         { -0.982149, 0.188106, 0, 0 },
                         { 0.931572, -0.363557, 0, 0 },
                         { -0.758352, 0.651845, 0, 0 },
                         { -0.487438, -0.873157, 0, 0 },
                         { 0.861552, 0.507670, 0, 0 },
                         { -0.912159, 0.409838, 0, 0 },
                         { -0.053744, -0.998555, 0, 0 },
                         { -0.238717, 0.971089, 0, 0 },
                         { -0.222771, -0.974871, 0, 0 },
                         { -0.197745, 0.980253, 0, 0 },
                         { 0.807861, 0.589373, 0, 0 },
                         { 0.627659, -0.778488, 0, 0 },
                         { -0.096511, -0.995332, 0, 0 },
                         { 0.251407, 0.967882, 0, 0 },
                         { -0.293260, 0.956033, 0, 0 },
                         { -0.933335, 0.359006, 0, 0 },
                         { 0.512623, -0.858613, 0, 0 },
                         { 0.984956, -0.172803, 0, 0 },
                         { 0.880901, 0.473301, 0, 0 },
                         { -0.538447, 0.842659, 0, 0 },
                         { -0.350216, 0.936669, 0, 0 },
                         { 0.094865, 0.995490, 0, 0 },
                         { -0.666336, -0.745651, 0, 0 },
                         { 0.804636, -0.593769, 0, 0 },
                         { 0.704390, 0.709813, 0, 0 },
                         { -0.941373, -0.337367, 0, 0 },
                         { -0.128035, -0.991770, 0, 0 },
                         { 0.997987, 0.063413, 0, 0 },
                         { 0.889448, 0.457037, 0, 0 },
                         { 0.085970, 0.996298, 0, 0 },
                         { -0.558246, -0.829675, 0, 0 },
                         { 0.927501, -0.373822, 0, 0 },
                         { -0.742646, -0.669684, 0, 0 },
                         { -0.176973, 0.984216, 0, 0 },
                         { 0.965002, -0.262244, 0, 0 },
                         { -0.967139, 0.254249, 0, 0 },
                         { 0.376475, -0.926427, 0, 0 },
                         { 0.997686, 0.067985, 0, 0 },
                         { -0.962827, -0.270120, 0, 0 },
                         { 0.918771, -0.394791, 0, 0 },
                         { 0.955923, -0.293616, 0, 0 },
                         { -0.835192, -0.549958, 0, 0 },
                         { 0.986247, -0.165277, 0, 0 },
                         { 0.885616, -0.464418, 0, 0 },
                         { 0.858064, -0.513542, 0, 0 },
                         { 0.836776, 0.547545, 0, 0 },
                         { 0.647592, -0.761987, 0, 0 },
                         { -0.140489, 0.990082, 0, 0 },
                         { 0.177041, 0.984204, 0, 0 },
                         { 0.307710, 0.951480, 0, 0 },
                         { -0.525163, 0.851002, 0, 0 },
                         { -0.910432, 0.413659, 0, 0 },
                         { 0.253572, -0.967317, 0, 0 },
                         { -0.754068, -0.656796, 0, 0 },
                         { -0.992462, -0.122552, 0, 0 },
                         { 0.094086, 0.995564, 0, 0 },
                         { -0.349653, 0.936879, 0, 0 },
                         { -0.997243, 0.074212, 0, 0 },
                         { -0.963125, -0.269053, 0, 0 },
                         { -0.982313, -0.187247, 0, 0 },
                         { -0.289677, -0.957125, 0, 0 },
                         { -0.116957, -0.993137, 0, 0 },
                         { 0.231497, 0.972836, 0, 0 },
                         { -0.990413, 0.138137, 0, 0 },
                         { -0.702902, -0.711287, 0, 0 },
                         { 0.528971, 0.848640, 0, 0 },
                         { 0.055213, 0.998475, 0, 0 },
                         { -0.962541, 0.271135, 0, 0 },
                         { -0.011213, 0.999937, 0, 0 },
                         { 0.526693, -0.850056, 0, 0 },
                         { -0.683970, -0.729510, 0, 0 },
                         { 0.453065, -0.891477, 0, 0 },
                         { -0.901665, 0.432435, 0, 0 },
                         { 0.622492, 0.782626, 0, 0 },
                         { -0.762133, 0.647421, 0, 0 },
                         { -0.222631, -0.974903, 0, 0 },
                         { -0.070972, 0.997478, 0, 0 },
                         { -0.243824, -0.969820, 0, 0 },
                         { 0.995355, -0.096277, 0, 0 },
                         { 0.978072, 0.208269, 0, 0 },
                         { -0.352556, -0.935791, 0, 0 },
                         { -0.963946, 0.266097, 0, 0 },
                         { 0.239096, -0.970996, 0, 0 },
                         { 0.708553, -0.705657, 0, 0 },
                         { 0.802703, -0.596379, 0, 0 },
                         { 0.165043, 0.986286, 0, 0 },
                         { 0.596792, 0.802396, 0, 0 },
                         { 0.999852, 0.017220, 0, 0 },
                         { 0.055022, -0.998485, 0, 0 },
                         { -0.170287, -0.985394, 0, 0 },
                         { 0.576363, 0.817194, 0, 0 },
                         { -0.444189, 0.895933, 0, 0 },
                         { -0.979189, 0.202953, 0, 0 },
                         { 0.996376, 0.085055, 0, 0 },
                         { 0.111717, 0.993740, 0, 0 },
                         { 0.179799, 0.983703, 0, 0 },
                         { -0.728363, 0.685191, 0, 0 },
                         { -0.999623, 0.027455, 0, 0 },
                         { -0.292166, 0.956368, 0, 0 },
                         { 0.018078, -0.999837, 0, 0 },
                         { 0.592911, -0.805268, 0, 0 },
                         { -0.829936, 0.557859, 0, 0 },
                         { 0.991595, 0.129378, 0, 0 },
                         { -0.743382, 0.668867, 0, 0 },
                         { -0.904579, -0.426306, 0, 0 },
                         { -0.996582, -0.082612, 0, 0 },
                         { 0.999785, 0.020721, 0, 0 },
                         { -0.599201, -0.800599, 0, 0 },
                         { 0.149476, 0.988765, 0, 0 },
                         { 0.340429, -0.940270, 0, 0 },
                         { 0.986376, -0.164506, 0, 0 },
                         { -0.823350, -0.567534, 0, 0 },
                         { -0.999755, -0.022144, 0, 0 },
                         { -0.998041, -0.062563, 0, 0 },
                         { 0.521545, -0.853224, 0, 0 },
                         { 0.024544, 0.999699, 0, 0 },
                         { 0.936368, -0.351020, 0, 0 },
                         { -0.522461, 0.852663, 0, 0 },
                         { -0.877389, -0.479779, 0, 0 },
                         { -0.817541, 0.575870, 0, 0 },
                         { 0.996631, 0.082017, 0, 0 },
                         { 0.072398, 0.997376, 0, 0 },
                         { -0.323685, -0.946165, 0, 0 },
                         { -0.983423, -0.181326, 0, 0 },
                         { -0.391094, -0.920351, 0, 0 },
                         { -0.349781, 0.936831, 0, 0 },
                         { -0.624564, 0.780974, 0, 0 },
                         { -0.861617, 0.507560, 0, 0 },
                         { 0.847270, -0.531162, 0, 0 },
                         { 0.499839, 0.866118, 0, 0 },
                         { -0.505839, 0.862628, 0, 0 },
                         { 0.098331, -0.995154, 0, 0 },
                         { -0.856267, 0.516534, 0, 0 },
                         { 0.114256, 0.993451, 0, 0 },
                         { 0.412197, 0.911095, 0, 0 },
                         { -0.229440, 0.973323, 0, 0 },
                         { -0.921418, 0.388574, 0, 0 },
                         { -0.827207, 0.561897, 0, 0 },
                         { -0.340117, 0.940383, 0, 0 },
                         { -0.750691, 0.660654, 0, 0 },
                         { 0.185444, 0.982655, 0, 0 },
                         { -0.999995, -0.003006, 0, 0 },
                         { 0.166481, -0.986045, 0, 0 },
                         { 0.957577, -0.288178, 0, 0 },
                         { -0.005864, -0.999983, 0, 0 },
                         { -0.938334, -0.345731, 0, 0 },
                         { 0.424240, -0.905550, 0, 0 },
                         { 0.964573, -0.263816, 0, 0 },
                         { 0.447084, 0.894492, 0, 0 },
                         { 0.996183, -0.087293, 0, 0 },
                         { -0.176941, 0.984222, 0, 0 },
                         { 0.964779, 0.263063, 0, 0 },
                         { 0.863886, -0.503687, 0, 0 },
                         { 0.789601, -0.613620, 0, 0 },
                         { -0.063986, -0.997951, 0, 0 },
                         { -0.760229, -0.649655, 0, 0 },
                         { -0.259189, -0.965827, 0, 0 },
                         { -0.998617, 0.052570, 0, 0 },
                         { -0.324861, -0.945762, 0, 0 },
                         { -0.082972, 0.996552, 0, 0 },
                         { 0.557911, 0.829901, 0, 0 },
                         { -0.850914, -0.525304, 0, 0 },
                         { -0.082438, -0.996596, 0, 0 },
                         { 0.931102, 0.364760, 0, 0 },
                         { -0.983306, 0.181962, 0, 0 },
                         { 0.260700, 0.965420, 0, 0 },
                         { 0.411857, 0.911248, 0, 0 },
                         { -0.136227, 0.990678, 0, 0 },
                         { -0.468390, 0.883522, 0, 0 },
                         { -0.950125, -0.311868, 0, 0 },
                         { 0.365841, -0.930677, 0, 0 },
                         { -0.971807, -0.235777, 0, 0 },
                         { 0.979528, 0.201308, 0, 0 },
                         { 0.341681, 0.939816, 0, 0 },
                         { 0.414273, 0.910153, 0, 0 },
                         { -0.996873, -0.079021, 0, 0 },
                         { -0.971404, 0.237432, 0, 0 },
                         { 0.624630, 0.543370, 0.827900, 0 },
                         { -0.134140, -0.944880, 0.954350, 0 },
                         { 0.387720, -0.434750, 0.582530, 0 },
                         { 0.121260, -0.192820, 0.227780, 0 },
                         { -0.203880, 0.111330, 0.232300, 0 },
                         { 0.831140, -0.292180, 0.881000, 0 },
                         { 0.107590, -0.578390, 0.588310, 0 },
                         { 0.282850, 0.790360, 0.839450, 0 },
                         { -0.366220, 0.395160, 0.538760, 0 },
                         { 0.755910, 0.219160, 0.787040, 0 },
                         { -0.526100, 0.023860, 0.526640, 0 },
                         { -0.882160, -0.244710, 0.915470, 0 },
                         { -0.488880, -0.293300, 0.570110, 0 },
                         { 0.440140, -0.085580, 0.448380, 0 },
                         { 0.211790, 0.513730, 0.555670, 0 },
                         { 0.054830, 0.957010, 0.958580, 0 },
                         { -0.590010, -0.705090, 0.919380, 0 },
                         { -0.800650, 0.246310, 0.837680, 0 },
                         { -0.194240, -0.184020, 0.267570, 0 },
                         { -0.436670, 0.767510, 0.883040, 0 },
                         { 0.216660, 0.116020, 0.245770, 0 },
                         { 0.156960, -0.856000, 0.870270, 0 },
                         { -0.758210, 0.583630, 0.956820, 0 },
                         { 0.992840, -0.029040, 0.993270, 0 },
                         { -0.222340, -0.579070, 0.620290, 0 },
                         { 0.550520, -0.669840, 0.867040, 0 },
                         { 0.464310, 0.281150, 0.542800, 0 },
                         { -0.072140, 0.605540, 0.609820, 0 } };
  float4 r0, r1, r2, r3, r4, r5, r6, r7, r8, r9, r10, r11;
  uint4 bitmask, uiDest;
  float4 fDest;

  r0.xy = (uint2)v0.xy;
  r0.zw = float2(0, 0);
  r1.xyzw = mapInputTexture0L.Load(r0.xyw).xyzw;
  r2.xyzw = mapInputTexture1P.Load(r0.xyz).xyzw;

  // Fix unorm => float
  r1 = max(0, r1);

  r0.z = max(r2.x, abs(r1.w));
  r0.w = cmp(0 < r0.z);
  if (r0.w != 0) {
    r0.xy = (int2)r0.xy & int2(15, 15);
    r0.y = (uint)r0.y << 4;
    r0.x = (int)r0.x + (int)r0.y;
    r0.y = r0.z + r0.z;
    r0.y = r0.y * r0.y;
    r0.y = 0.0280499998 * r0.y;
    r0.y = min(1, r0.y);
    r0.y = log2(r0.y);
    r0.y = 0.649999976 * r0.y;
    r0.y = exp2(r0.y);
    r0.y = 28 * r0.y;
    r0.y = ceil(r0.y);
    r0.y = (uint)r0.y;
    r0.y = max(4, (uint)r0.y);
    r2.xy = (int2)g_i2OutputSize.xy;
    r0.w = 0.333333343 * abs(r1.w);
    r2.zw = icb[r0.x + 0].xy * float2(-1, 1);
    r5.xyz = float3(0, 0, 0);
    r6.xy = float2(0, 0);
    r3.xyzw = float4(0, 0, 0, 0);
    r4.xyzw = float4(0, 0, 0, 0);
    while (true) {
      r5.w = cmp((uint)r4.w >= (uint)r0.y);
      if (r5.w != 0) break;
      r7.x = dot(icb[r4.w + 256].yx, icb[r0.x + 0].xy);
      r7.y = dot(icb[r4.w + 256].xy, r2.zw);
      r6.zw = r7.xy * r0.zz;
      r6.zw = r6.zw / r2.xy;
      r6.zw = v2.xy + r6.zw;
      r7.xyzw = mapInputTexture0L.SampleLevel(samplerInputTexture0L_s, r6.zw, 0).xyzw;

      r7 = max(0, r7);

      r5.w = icb[r4.w + 256].z * r0.z;
      r5.w = cmp(abs(r7.w) >= r5.w);
      r5.w = r5.w ? 1.000000 : 0;
      r6.z = cmp(0 < r7.w);
      r6.w = saturate(abs(r1.w) / r7.w);
      r7.w = 1 + -r6.w;
      r6.w = r0.w * r7.w + r6.w;
      r8.x = r6.x + r6.w;
      r9.xyz = r7.xyz * r6.www + r3.xyz;
      r10.y = r6.y + r5.w;
      r11.xyz = r7.xyz * r5.www + r4.xyz;
      r3.xyz = r6.zzz ? r9.xyz : r3.xyz;
      r4.xyz = r6.zzz ? r4.xyz : r11.xyz;
      r8.y = r6.y;
      r10.x = r6.x;
      r6.xy = r6.zz ? r8.xy : r10.xy;
      r3.w = 1 + r3.w;
      r5.xyz = r7.xyz + r5.xyz;
      r4.w = (int)r4.w + 1;
    }
    r0.x = (uint)r0.y;
    r0.y = max(0.00100000005, r6.y);
    r0.yzw = r4.xyz / r0.yyy;
    r2.x = r6.y / r0.x;
    r0.x = 0.5 * r0.x;
    r2.y = max(0.00100000005, r6.x);
    r2.yzw = r3.xyz / r2.yyy;
    r0.x = r6.x / r0.x;
    r3.xyz = r5.xyz / r3.www;
    r3.w = saturate(r1.w * -10 + -r2.x);
    r3.w = max(r3.w, r2.x);
    r4.x = r3.w + r3.w;
    r3.xyz = r4.xxx * r3.xyz;
    r3.w = r3.w * 2 + r2.x;
    r4.x = cmp(0 < r2.x);
    r4.y = cmp(r1.w < 0);
    r4.x = (int)r4.y | (int)r4.x;
    r4.x = r4.x ? 1.000000 : 0;
    o0.w = saturate(r0.x * r4.x + r3.w);
    r0.yzw = r0.yzw * r2.xxx + r3.xyz;
    r2.xyz = r2.yzw * r0.xxx + r0.yzw;
    r2.w = r3.w + r0.x;
    r0.x = cmp(0 >= r2.w);
    r1.w = 1;
    r0.xyzw = r0.xxxx ? r1.xyzw : r2.xyzw;
    o0.xyz = r0.xyz / r0.www;

    o0 = max(0, o0);
    return;
  } else {
    o0.xyz = r1.xyz;
    o0.w = 0;

    o0 = max(0, o0);
    return;
  }
  return;
}
